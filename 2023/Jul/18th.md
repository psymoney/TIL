## Mongodb server config 수정
### 문제 상황: 
ec2에 올려둔 mongodb에 접속이 되지 않음    
connection refused가 반복됨

### 시도한 것:
1. db가 올라가 있는 ec2의 security group inbound 수정 TCP 0.0.0.0/0, 27017 포트에 대한 인바운드 허용:   
해당 방법은 별다른 효과가 없었다. 기본 보안그룹에서 TCP 0.0.0.0/0에 대한 모든 인바운드가 허용되고 있었다.
2. mongodb config 파일 수정.
```
sudo vi/etc/mongod.conf
```
명령어를 통해 설정 파일의 bindIp 값을 `127.0.0.1`에서 `0.0.0.0`으로 수정해주었다.

이후 아래 명령어로 mongod 서비스 재시작
```
sudo systemctl restart mongod.service
```

### 참고자료:
- [[AWS] 아마존(aws) 클라우드를 이용한 MongoDB 서버 구축](https://jeeu147.tistory.com/143)

## AWS CodeDeploy script execution directory
### 문제 상황:
- AWS CodeDeploy의 BeforeInstall 이벤트 단계 스크립트 실행 실패
```text
[stderr] Can't find a suitable configuration file in this directory or any parent. Are you in the right directory?
[stderr] Supported filenames: docker-compose.yml, docker-compose.yaml, compose.yml, compose.yaml
```
- 로그 일부
```
[2023-07-18 06:40:13.622] [d-JGV338UNO]LifecycleEvent - ApplicationStop
[2023-07-18 06:40:13.623] [d-JGV338UNO]Script - stop.sh
[2023-07-18 06:40:14.399] [d-JGV338UNO][stderr]Stopping homepage     ...
[2023-07-18 06:40:14.399] [d-JGV338UNO][stderr]Stopping homepage-api ...
[2023-07-18 06:40:24.845] [d-JGV338UNO][stderr]Stopping homepage     ... done
[2023-07-18 06:40:25.205] [d-JGV338UNO][stderr]Stopping homepage-api ... done
[2023-07-18 06:40:25.224] [d-JGV338UNO][stderr]Removing homepage     ...
[2023-07-18 06:40:25.224] [d-JGV338UNO][stderr]Removing homepage-api ...
[2023-07-18 06:40:25.258] [d-JGV338UNO][stderr]Removing homepage-api ... done
[2023-07-18 06:40:25.273] [d-JGV338UNO][stderr]Removing homepage     ... done
[2023-07-18 06:40:25.274] [d-JGV338UNO][stderr]Removing network web_web-api
[2023-07-18 06:40:28.680] [d-JGV338UNO]LifecycleEvent - AfterInstall
[2023-07-18 06:40:28.680] [d-JGV338UNO]Script - docker-pull.sh
[2023-07-18 06:40:28.687] [d-JGV338UNO][stdout]Current directory: /opt/codedeploy-agent
[2023-07-18 06:40:30.786] [d-JGV338UNO][stderr]WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
[2023-07-18 06:40:30.788] [d-JGV338UNO][stderr]Configure a credential helper to remove this warning. See
[2023-07-18 06:40:30.789] [d-JGV338UNO][stderr]https://docs.docker.com/engine/reference/commandline/login/#credentials-store
[2023-07-18 06:40:30.789] [d-JGV338UNO][stderr]
[2023-07-18 06:40:30.789] [d-JGV338UNO][stdout]Login Succeeded
[2023-07-18 06:40:31.064] [d-JGV338UNO][stderr]Pulling homepage-api ...
[2023-07-18 06:40:31.064] [d-JGV338UNO][stderr]Pulling homepage     ...
[2023-07-18 06:40:31.211] [d-JGV338UNO][stderr]Pulling homepage     ... pulling from homepage
[2023-07-18 06:40:31.215] [d-JGV338UNO][stderr]Pulling homepage-api ... pulling from homepage-api
[2023-07-18 06:40:31.216] [d-JGV338UNO][stderr]Pulling homepage     ... digest: sha256:6fc98770b15171eb6f...
[2023-07-18 06:40:31.217] [d-JGV338UNO][stderr]Pulling homepage     ... status: image is up to date for 1...
[2023-07-18 06:40:31.220] [d-JGV338UNO][stderr]Pulling homepage     ... done
[2023-07-18 06:40:31.221] [d-JGV338UNO][stderr]Pulling homepage-api ... digest: sha256:1511ae2a127fc14e38...
[2023-07-18 06:40:31.222] [d-JGV338UNO][stderr]Pulling homepage-api ... status: image is up to date for 1...
[2023-07-18 06:40:31.228] [d-JGV338UNO][stderr]Pulling homepage-api ... done
[2023-07-18 06:40:31.421] [d-JGV338UNO]LifecycleEvent - ApplicationStart
[2023-07-18 06:40:31.421] [d-JGV338UNO]Script - docker-run.sh
[2023-07-18 06:40:31.428] [d-JGV338UNO][stdout]Current directory: /opt/codedeploy-agent
[2023-07-18 06:40:31.720] [d-JGV338UNO][stderr]Creating network "web_web-api" with driver "bridge"
[2023-07-18 06:40:31.842] [d-JGV338UNO][stderr]Creating homepage-api ...
[2023-07-18 06:40:32.625] [d-JGV338UNO][stderr]Creating homepage-api ... done
[2023-07-18 06:40:32.631] [d-JGV338UNO][stderr]Creating homepage     ...
[2023-07-18 06:40:33.165] [d-JGV338UNO][stderr]Creating homepage     ... done
[2023-07-18 06:40:33.336] [d-JGV338UNO][stdout]Total reclaimed space: 0B
```
- 스크립트가 실행되는 위치가 /opt/codedeploy-agent 임
- 개정파일이 appspec.yml의 files 항목에서 source가 destination으로 복사되는 이벤트 단계는 Install임
- 수정된 스크립트를 배포에 온전하게 반영하기 위해선 변경되는 스크립트가 Install 단계 직후인 AfterInstall 이후로 설정되어야 함

### 참고자료:
- [AWS Guide: AppSpec 'hooks' 섹션](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html)
- [AWS Guide: AppSpec 'files' section (EC2/On-premiss deplouments only)](https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-files.html)
- [StackOverflow: AWS CodeDeploy hooks scripts execution location](https://stackoverflow.com/questions/48555272/aws-codedeploy-hooks-scripts-execution-location)
